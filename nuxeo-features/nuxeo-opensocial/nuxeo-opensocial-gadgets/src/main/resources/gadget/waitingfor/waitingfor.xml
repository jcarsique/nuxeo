<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="My Pending Requests" category="business"
    render_inline="required" scrolling="false" author="Thomas Roger"
    author_aboutme="nuxeo" singleton="false"
    thumbnail="${clientSideBaseUrl}site/gadgets/waitingfor/waiting_for.png"
    screenshot="${clientSideBaseUrl}site/gadgets/waitingfor/screenshot.png"
    >
      <Require feature="settitle" />
      <Require feature="setprefs"/>
      <#include "dynamic-translations.ftl"/>
      <Require feature="dynamic-height" />
      <#include "default-oauth-prefs.ftl"/>
  </ModulePrefs>
  <#include "context-prefs.ftl"/>
  <UserPref name="title" display_name="Title" required="false" default_value="My pending requests"/>

  <Content type="html">
    <![CDATA[
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="${specDirectoryUrl}gadget-common.css"/>
    <link rel="stylesheet" type="text/css" href="${specDirectoryUrl}documentlists.css"/>

    <!-- insert JS Context -->
    ${jsContext}

    <script src="${specDirectoryUrl}default-automation-request.js"></script>
    <script type="text/javascript" language="javascript" src="waitingfor.js"></script>
    <script type="text/javascript">
      var prefs = new gadgets.Prefs();

      // configure Automation REST call
      var NXRequestParams = {
        operationId: 'Workflow.UserProcessPageProvider',
        operationParams: {
          language: prefs.getLang(),
          pageSize: 5
        },
        operationContext: {},
        usePagination: true,
        operationCallback: displayProcesses,
        displayColumns: [
          {type: 'text', field: 'processInstanceName', label: '__MSG_label.name__'},
          {type: 'builtin', field: 'titleWithLink', label: '__MSG_label.title__'},
          {type: 'date', field: 'startDate', label: '__MSG_label.workflow.task.startDate__'}
        ],
        noEntryLabel: "__MSG_label.dashboard.user.document.process.empty__"
      };

      // execute automation request onload
      gadgets.util.registerOnLoadHandler(function() {
       doAutomationRequest(NXRequestParams);
      });
    </script>
  </head>
  <body>
   <div class="tools">
   </div>
   <div id="content">
     <#include "default-documentlist-layout.ftl"/>
     <#include "default-request-controls.ftl"/>
   </div>
  </body>
</html>
]]>
  </Content>
</Module>
