<div xmlns:h="http://java.sun.com/jsf/html"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:a4j="http://richfaces.org/a4j">

  <a4j:region>
    <a4j:outputPanel id="profilePanel">

      <a4j:form id="userProfileButtons">
        <table class="dataInput">
          <tbody>
            <tr>
              <td class="iconColumn"></td>
              <td class="labelColumn">
                <a4j:commandButton
                  value="#{messages['label.userManager.editUser']}"
                  action="#{userProfileActions.setMode('edit')}"
                  styleClass="button" id="editUserButton"
                  rendered="#{userProfileActions.mode == 'view'}"
                  reRender="profilePanel" />
                <a4j:commandButton
                  value="#{messages['command.cancel']}"
                  actionListener="#{editableListBean.resetAllListsCachedModels}"
                  action="#{userProfileActions.setMode('view')}"
                  styleClass="button" id="viewUserButton"
                  rendered="#{userProfileActions.mode != 'view'}"
                  reRender="profilePanel" />
              </td>
              <td class="fieldColumn">
                 <a4j:commandButton
                    value="#{messages['command.change.password']}"
                    action="#{userProfileActions.setMode('editPassword')}"
                    styleClass="button" id="editUserPasswordButton"
                    rendered="#{userProfileActions.mode == 'view' and userProfileActions.canEdit}"
                    reRender="profilePanel" />
              </td>
            </tr>
          </tbody>
        </table>
      </a4j:form>

      <h:form id="viewUser" rendered="#{userProfileActions.mode == 'view'}">
        <nxl:layout name="summary_user_profile_layout" mode="view"
          value="#{userProfileActions.userProfile}" />
      </h:form>

      <h:form id="editUser" enctype="multipart/form-data"
        rendered="#{userProfileActions.mode == 'edit'}">
        <nxl:layout name="user" mode="#{userProfileActions.canEdit ? 'edit' : 'view'}" value="#{userProfileActions.currentUserModel}" />
        <nxl:layout name="userprofile" mode="edit" value="#{userProfileActions.userProfileDocument}" />
        <table class="dataInput">
          <tbody>
            <tr>
              <td class="iconColumn"></td>
              <td class="labelColumn">
                <h:commandButton id="saveUserButton"
                  value="#{messages['command.save']}"
                  action="#{userProfileActions.updateUser}"
                  styleClass="button" />
              </td>
              <td class="fieldColumn"></td>
            </tr>
          </tbody>
        </table>
      </h:form>

      <h:form id="editUserPassword" rendered="#{userProfileActions.mode == 'editPassword'}">
        <nxl:layout name="user" mode="#{userProfileActions.canEdit ? 'editPassword' : 'hidden'}" value="#{userProfileActions.currentUserModel}" />
        <table class="dataInput">
          <tbody>
            <tr>
              <td class="iconColumn"></td>
              <td class="labelColumn">
                <h:commandButton id="saveUserPasswordButton"
                  value="#{messages['command.save']}"
                  action="#{userManagementActions.changePassword}"
                  styleClass="button"
                  rendered="#{userProfileActions.canEdit}" />
              </td>
              <td class="fieldColumn"></td>
            </tr>
          </tbody>
        </table>
      </h:form>

    </a4j:outputPanel>
  </a4j:region>

</div>
