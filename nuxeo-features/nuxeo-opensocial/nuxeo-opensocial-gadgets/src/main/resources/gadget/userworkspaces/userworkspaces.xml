<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="My Workspaces"
    description="List users workspaces for a given scope"
    author="tdeprat" author_email="tdelprat@nuxeo.com"
    	thumbnail="${clientSideBaseUrl}site/gadgets/userworkspaces/user_workspace.png"
    	screenshot="${clientSideBaseUrl}site/gadgets/userworkspaces/screenshot.png">
    >
    <Require feature="nuxeo" />
    <Require feature="setprefs"/>
    <#include "dynamic-translations.ftl"/>
    <Require feature="dynamic-height" />
    <#include "default-oauth-prefs.ftl"/>
  </ModulePrefs>
  <#include "context-prefs.ftl"/>
  <Content type="html">

<![CDATA[
<html>
  <head>

  <link rel="stylesheet" type="text/css" href="${specDirectoryUrl}gadget-common.css"/>
  <link rel="stylesheet" type="text/css" href="${specDirectoryUrl}documentlists.css"/>

  <!-- insert JS Context -->
  ${jsContext}

  <script src="${specDirectoryUrl}default-automation-request.js"></script>
  <script src="${specDirectoryUrl}default-documentlist-display.js"></script>
  <script src="${specDirectoryUrl}context-management.js"></script>

  <script type="text/javascript">
    var prefs = new gadgets.Prefs();

    var requestScope = getTargetContextPath();
    // configure Automation REST call
    var NXRequestParams = {
      operationId: 'Document.PageProvider',
      operationParams: {
        providerName: 'user_workspaces',
        pageSize: 5,
        queryParams: requestScope == '/' ? requestScope : requestScope + '/'
      },
      operationContext: {},
      operationDocumentProperties: "common,dublincore",
      entityType: 'documents',
      usePagination: true,
      displayMethod: displayDocumentList,
      displayColumns: [
        {type: 'builtin', field: 'icon'},
        {type: 'builtin', field: 'titleWithLink', label: '__MSG_label.dublincore.title__'},
        {type: 'date', field: 'dc:modified', label: '__MSG_label.dublincore.modified__'},
        {type: 'text', field: 'dc:creator', label: '__MSG_label.dublincore.creator__'}
      ],
      noEntryLabel: '__MSG_label.gadget.no.document__'
    };

    // execute automation request onload
    gadgets.util.registerOnLoadHandler(function() {
      initContextPathSettingsButton();
      doAutomationRequest(NXRequestParams);
    });
  </script>

  </head>
   <body>
   <div class="tools">
     <#include "context-chooser-ui.ftl"/>
   </div>
   <div id="content">
     <#include "default-documentlist-layout.ftl"/>
     <#include "default-request-controls.ftl"/>
   </div>
  </body>
</html>
]]>
  </Content>
</Module>
