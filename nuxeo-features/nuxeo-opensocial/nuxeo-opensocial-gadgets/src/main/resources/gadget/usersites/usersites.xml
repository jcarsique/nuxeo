<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="My Sites" category="business"  render_inline="required"
    scrolling="false" author="Thierry Delprat" directory_title="My Sites"
    author_aboutme="nuxeo" singleton="false"
    thumbnail="${clientSideBaseUrl}site/gadgets/usersites/user_sites.png"
    screenshot="${clientSideBaseUrl}site/gadgets/usersites/screenshot.png">
    <Require feature="setprefs"/>
    <Require feature="settitle" />
    <#include "dynamic-translations.ftl"/>
    <Require feature="dynamic-height" />
    <#include "default-oauth-prefs.ftl"/>
  </ModulePrefs>
  <UserPref name="title" display_name="Title" required="false" default_value="My Sites"/>

  <Content type="html">
<![CDATA[
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="${specDirectoryUrl}gadget-common.css"/>
    <link rel="stylesheet" type="text/css" href="${specDirectoryUrl}documentlists.css"/>

    <!-- insert JS Context -->
    ${jsContext}

    <script src="${specDirectoryUrl}default-automation-request.js"></script>
    <script src="${specDirectoryUrl}default-documentlist-display.js"></script>
    <script src="${specDirectoryUrl}context-management.js"></script>
    <script type="text/javascript">
      var prefs = new gadgets.Prefs();

      var requestScope = getTargetContextPath();
      // configure Automation REST call
      var NXRequestParams = {
        operationId: 'Document.PageProvider',
        operationParams: {
          providerName: 'user_sites',
          pageSize: 5,
          queryParams: requestScope == '/' ? requestScope : requestScope + '/'
        },
        operationContext: {},
        operationDocumentProperties: "common,dublincore",
        entityType: 'documents',
        usePagination: true,
        displayMethod: displayDocumentList,
        displayColumns: [
          {type: 'builtin', field: 'icon'},
          {type: 'builtin', field: 'titleWithLink', label: '__MSG_label.dublincore.title__'},
          {type: 'date', field: 'dc:modified', label: '__MSG_label.dublincore.modified__'},
          {type: 'text', field: 'dc:creator', label: '__MSG_label.dublincore.creator__'}
        ],
        noEntryLabel: '__MSG_label.gadget.no.document__'
      };

      // execute automation request onload
      gadgets.util.registerOnLoadHandler(function() {
       doAutomationRequest(NXRequestParams);
      });
    </script>
  </head>
  <body>
    <div id="content">
      <#include "default-documentlist-layout.ftl"/>
      <#include "default-request-controls.ftl"/>
     </div>
  </body>
</html>
]]>
  </Content>
</Module>
